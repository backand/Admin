(function(a){a.widget("ui.dropdownchecklist",{version:function(){alert("DropDownCheckList v1.1")},_appendDropContainer:function(b){var d=a("<div/>");d.addClass("ui-dropdownchecklist ui-dropdownchecklist-dropcontainer-wrapper");d.addClass("ui-widget");d.attr("id",b.attr("id")+"-ddw");d.css({position:"absolute",left:"0",top:"-33000px"});var c=a("<div/>");c.addClass("ui-dropdownchecklist-dropcontainer ui-widget-content");c.css("overflow-y","auto");d.append(c);d.insertAfter(b);d.isOpen=false;return d},_isDropDownKeyShortcut:function(c,b){return c.altKey&&(a.ui.keyCode.DOWN==b)},_isDropDownCloseKey:function(c,b){return(a.ui.keyCode.ESCAPE==b)||(a.ui.keyCode.ENTER==b)},_keyFocusChange:function(f,i,c){var g=a(":focusable");var d=g.index(f);if(d>=0){d+=i;if(c){var e=this.dropWrapper.find("input:not([disabled])");var b=g.index(e.get(0));var h=g.index(e.get(e.length-1));if(d<b){d=h}else{if(d>h){d=b}}}g.get(d).focus()}},_handleKeyboard:function(d){var b=this;var c=(d.keyCode||d.which);if(!b.dropWrapper.isOpen&&b._isDropDownKeyShortcut(d,c)){d.stopImmediatePropagation();b._toggleDropContainer(true)}else{if(b.dropWrapper.isOpen&&b._isDropDownCloseKey(d,c)){d.stopImmediatePropagation();b._toggleDropContainer(false);b.controlSelector.focus()}else{if(b.dropWrapper.isOpen&&(d.target.type=="checkbox")&&((c==a.ui.keyCode.DOWN)||(c==a.ui.keyCode.UP))){d.stopImmediatePropagation();b._keyFocusChange(d.target,(c==a.ui.keyCode.DOWN)?1:-1,true)}else{if(b.dropWrapper.isOpen&&(c==a.ui.keyCode.TAB)){}}}}},_handleFocus:function(f,d,b){var c=this;if(b&&!c.dropWrapper.isOpen){f.stopImmediatePropagation();if(d){c.controlSelector.addClass("ui-state-hover");if(a.ui.dropdownchecklist.gLastOpened!=null){a.ui.dropdownchecklist.gLastOpened._toggleDropContainer(false)}}else{c.controlSelector.removeClass("ui-state-hover")}}else{if(!b&&!d){if(f!=null){f.stopImmediatePropagation()}c.controlSelector.removeClass("ui-state-hover");c._toggleDropContainer(false)}}},_cancelBlur:function(c){var b=this;if(b.blurringItem!=null){clearTimeout(b.blurringItem);b.blurringItem=null}},_appendControl:function(){var m=this,c=this.sourceSelect,n=this.options;var b=a("<span/>");b.addClass("ui-dropdownchecklist ui-dropdownchecklist-selector-wrapper ui-widget");b.css({cursor:"default",overflow:"hidden"});var f=c.attr("id");if((f==null)||(f=="")){f="ddcl-"+a.ui.dropdownchecklist.gIDCounter++}else{f="ddcl-"+f}b.attr("id",f);var h=a("<div/>");var j=c.attr("isGroupFilter");var k=j=="True"?"inline-block":"block";h.addClass("ui-dropdownchecklist-selector ui-state-default");var i=(navigator.appVersion.indexOf("MSIE 7.")==-1)?false:true;h.css({display:k,overflow:"hidden","white-space":"nowrap"});if(i){h.css("position","relative")}var d=c.attr("tabIndex");if(d==null){d=0}else{d=parseInt(d);if(d<0){d=0}}h.attr("tabIndex",d);h.keyup(function(o){m._handleKeyboard(o)});h.focus(function(o){m._handleFocus(o,true,true)});h.blur(function(o){m._handleFocus(o,false,true)});b.append(h);var l=null;if(n.icon!=null){l=(n.icon.placement==null)?"left":n.icon.placement;var g=a("<div/>");g.addClass("ui-icon");g.addClass((n.icon.toOpen!=null)?n.icon.toOpen:"ui-icon-triangle-1-e");if(i){g.css({position:"absolute"});g.css(l,"0")}else{g.css({"float":l})}h.append(g)}var e=a("<span/>");e.addClass("ui-dropdownchecklist-text");if(i){e.css({display:"inline-block","white-space":"nowrap",overflow:"hidden"});if(l){e.css("padding-"+l,"16px")}}else{e.css({display:"inline-block","white-space":"nowrap",overflow:"hidden"})}h.append(e);b.hover(function(){if(!m.disabled){h.addClass("ui-state-hover")}},function(){if(!m.disabled){h.removeClass("ui-state-hover")}});b.click(function(o){if(!m.disabled){o.stopImmediatePropagation();m._toggleDropContainer(!m.dropWrapper.isOpen)}});b.insertAfter(c);a(window).resize(function(){if(!m.disabled&&m.dropWrapper.isOpen){m._toggleDropContainer(true)}});return b},_createDropItem:function(g,f,o,l,h,e,k){var m=this,c=this.options,d=this.sourceSelect,p=this.controlWrapper;var s=a("<div/>");s.addClass("ui-dropdownchecklist-item");s.css({"white-space":"nowrap"});var q=h?' checked="checked"':"";var j=e?' class="inactive"':' class="active"';var b=p.attr("id");var n=b+"-i"+g;var r;if(m.isMultiple){r=a('<input disabled type="checkbox" id="'+n+'"'+q+j+' tabindex="'+f+'" />')}else{r=a('<input disabled type="radio" id="'+n+'" name="'+b+'"'+q+j+' tabindex="'+f+'" />')}r=r.attr("index",g).val(o);s.append(r);var i=a("<label for="+n+"/>");i.addClass("ui-dropdownchecklist-text");i.css({cursor:"default"});i.text(l);if(k){s.addClass("ui-dropdownchecklist-indent")}s.addClass("ui-state-default");if(e){s.addClass("ui-state-disabled")}i.click(function(t){t.stopImmediatePropagation()});s.append(i);s.hover(function(u){var t=a(this);if(!t.hasClass("ui-state-disabled")){t.addClass("ui-state-hover")}},function(u){var t=a(this);t.removeClass("ui-state-hover")});r.change(function(u){var t=a(this);u.stopImmediatePropagation();if(t.hasClass("active")){m._syncSelected(t);m.sourceSelect.trigger("change","ddcl_internal");if(!m.isMultiple&&c.closeRadioOnClick){m._toggleDropContainer(false)}}});a(r).checkbox({cls:"jquery-safari-checkbox"});s.click(function(w){var v=a(this);w.stopImmediatePropagation();if(!v.hasClass("ui-state-disabled")){var t=v.find("input");var u=Durados.CheckBox.IsChecked(t);m._syncSelected(t);m.sourceSelect.trigger("change","ddcl_internal");if(!u&&!m.isMultiple&&c.closeRadioOnClick){m._toggleDropContainer(false)}}else{v.focus();m._cancelBlur()}});s.focus(function(u){var t=a(this);u.stopImmediatePropagation()});s.keyup(function(t){m._handleKeyboard(t)});return s},_createGroupItem:function(f,d){var b=this;var e=a("<div />");e.addClass("ui-dropdownchecklist-group ui-widget-header");if(d){e.addClass("ui-state-disabled")}e.css({"white-space":"nowrap"});var c=a("<span/>");c.addClass("ui-dropdownchecklist-text");c.css({cursor:"default"});c.text(f);e.append(c);e.click(function(h){var g=a(this);h.stopImmediatePropagation();g.focus();b._cancelBlur()});e.focus(function(h){var g=a(this);h.stopImmediatePropagation()});return e},_appendItems:function(){var d=this,h=this.sourceSelect,g=this.dropWrapper;var b=g.find(".ui-dropdownchecklist-dropcontainer");h.children().each(function(j){var k=a(this);if(k.is("option")){d._appendOption(k,b,j,false,false)}else{if(k.is("optgroup")){var l=k.attr("disabled");var n=k.attr("label");if(n!=""){var m=d._createGroupItem(n,l);b.append(m)}d._appendOptions(k,b,j,true,l)}}});var c=b.outerWidth();var e=b.outerHeight();if(c<10){var f=h.attr("d_minWidth");if(f==null||f==""||f==0){f=100}c=f}var i=19;if(h.children().length>0&&e<i){e=i*h.children().length}return{width:c,height:e}},_appendOptions:function(g,d,f,c,b){var e=this;g.children("option").each(function(h){var i=a(this);var j=(f+"."+h);e._appendOption(i,d,j,c,b)})},_appendOption:function(g,b,h,d,m){var l=this;var j=g.text();var i=g.val();var f=g.attr("selected");var e=(m||g.attr("disabled"));var c=l.controlSelector.attr("tabindex");var k=l._createDropItem(h,c,i,j,f,e,d);b.append(k)},_syncSelected:function(h){var i=this,k=this.options,c=this.sourceSelect,d=this.dropWrapper;var f=d.find("input.active");if(k.firstItemChecksAll){if((h!=null)&&(h.attr("index")==0)){var g=Durados.CheckBox.IsChecked(h);Durados.CheckBox.SetChecked(f,g)}else{var e=true;var j=null;f.each(function(l){if(l>0){var m=Durados.CheckBox.IsChecked(a(this));if(!m){e=false}}else{j=a(this)}});if(j!=null){var g=e&&f.length>2;Durados.CheckBox.SetChecked(j,g)}}}f=d.find("input");var b=c.get(0).options;f.each(function(l){if(l!=0||!k.firstItemChecksAll){var m=Durados.CheckBox.IsChecked(a(this));a(b[l]).attr("selected",m)}});i._updateControlText();if(h!=null){h.focus()}},_sourceSelectChangeHandler:function(c){var b=this,d=this.dropWrapper;d.find("input").val(b.sourceSelect.val());b._updateControlText()},_updateControlText:function(){var c=this,g=this.sourceSelect,d=this.options,f=this.controlWrapper;var h=g.find("option:first");var b=g.find("option");var i=c._formatText(b,d.firstItemChecksAll,h);var e=f.find(".ui-dropdownchecklist-text");if(g.attr("filter")=="filter"){this.controlSelector.css({width:this.controlSelector.width()+"px"})}e.html(i);e.attr("title",i)},_formatText:function(b,d,e){var f;if(a.isFunction(this.options.textFormatFunction)){try{f=this.options.textFormatFunction(b)}catch(c){alert("textFormatFunction failed: "+c)}}else{if(d&&(e!=null)&&e.attr("selected")){f=e.text()}else{f="";b.each(function(){if(a(this).attr("selected")){if(f!=""){f+=", "}f+=a(this).text()}});if(f==""){f=(this.options.emptyText!=null)?this.options.emptyText:"&nbsp;"}}}return f},_toggleDropContainer:function(f){var c=this;var e=function(){d(c)};var d=function(g){if((g!=null)&&g.dropWrapper.isOpen){g.dropWrapper.isOpen=false;a.ui.dropdownchecklist.gLastOpened=null;var i=g.options;g.dropWrapper.css({top:"-33000px",left:"0"});var h=g.controlSelector;h.removeClass("ui-state-active");h.removeClass("ui-state-hover");var k=g.controlWrapper.find(".ui-icon");if(k.length>0){k.removeClass((i.icon.toClose!=null)?i.icon.toClose:"ui-icon-triangle-1-s");k.addClass((i.icon.toOpen!=null)?i.icon.toOpen:"ui-icon-triangle-1-e")}a(document).unbind("click",e);g.dropWrapper.find("input.active").attr("disabled","disabled");if(a.isFunction(i.onComplete)){try{i.onComplete.call(g,g.sourceSelect.get(0))}catch(j){alert("callback failed: "+j)}}}};var b=function(h){if(!h.dropWrapper.isOpen){h.dropWrapper.isOpen=true;a.ui.dropdownchecklist.gLastOpened=h;h._setSize(h.dropCalculatedSize,h.sourceSelect);var n=h.controlWrapper.position().top+h.controlWrapper.outerHeight();if(isDockFields(null)){n+=h.controlWrapper.parents(".ui-dialog-content.ui-widget-content").scrollTop()}else{if(isDock(null)){n+=h.controlWrapper.parents("#DataRowEdit").scrollTop()}}var g=h.controlWrapper.position().left;if(h.options.icon.placement=="right"){g=g-h.dropWrapper.width()+h.controlWrapper.width()}var j=h.options;h.dropWrapper.css({top:n+"px",left:g+"px"});h.dropWrapper.css({zIndex:9999999});var i=h.controlSelector;i.addClass("ui-state-active");i.removeClass("ui-state-hover");var k=h.controlWrapper.find(".ui-icon");if(k.length>0){k.removeClass((j.icon.toOpen!=null)?j.icon.toOpen:"ui-icon-triangle-1-e");k.addClass((j.icon.toClose!=null)?j.icon.toClose:"ui-icon-triangle-1-s")}Durados.dropdowndiv.hide();a(document).bind("click",e);var m=h.dropWrapper.find("input.active");m.removeAttr("disabled");var l=m.get(0);if(l!=null){l.focus()}}};if(f){d(a.ui.dropdownchecklist.gLastOpened);c.sourceSelect.trigger("drop",{select:c});b(c)}else{c.sourceSelect.trigger("blur",{select:c});d(c)}},_setSize:function(b,c){var r=this.options,f=this.dropWrapper,q=this.controlWrapper;var j=this.controlSelector;if(c.attr("filter")!="filter"||c.attr("isGroupFilter")=="True"){var p;if(r.width!=null){p=parseInt(r.width)}else{if(b.width>p){p=b.width}}if(r.minWidth&&p<r.minWidth){p=r.minWidth}if(p==null){if(c.css("width")!=""){p=c.css("width")}}if(p!=null){p=p.toString().replace("px","");j.css({width:p+"px"})}var g=j.find(".ui-dropdownchecklist-text");var d=j.find(".ui-icon");if(d!=null){p-=(d.outerWidth()+6);g.css({width:p+"px"})}}var o=(r.maxDropHeight!=null)?parseInt(r.maxDropHeight):-1;var k=20;var n=this.controlWrapper.offset().top;var i=a(window).height();var m=i-n-30;if(m<o){o=m}else{}var h=((o>0)&&(b.height>o))?o:b.height;if(h==0){var l=a(c).find("option").length;if(l==null||l==0){h=100}else{h=l*25;if(h>200){h=200}}}var e=parseInt(b.width);e+=parseInt(k);a(f).css({height:h+"px",width:e+"px"});f.find(".ui-dropdownchecklist-dropcontainer").css({height:h+"px"})},_init:function(){var c=this,d=this.options;if(a.ui.dropdownchecklist.gIDCounter==null){a.ui.dropdownchecklist.gIDCounter=1}c.blurringItem=null;var g=c.element;c.initialDisplay=g.css("display");g.css("display","none");c.initialMultiple=g.attr("multiple");c.isMultiple=c.initialMultiple;if(d.forceMultiple!=null){c.isMultiple=d.forceMultiple}g.attr("multiple",true);c.sourceSelect=g;var e=c._appendControl();c.controlWrapper=e;c.controlSelector=e.find(".ui-dropdownchecklist-selector");var f=c._appendDropContainer(e);c.dropWrapper=f;var b=c._appendItems();c.dropCalculatedSize=b;c._updateControlText(e,f,g);c._setSize(b,g);if(d.firstItemChecksAll){c._syncSelected(null)}if(d.bgiframe&&typeof c.dropWrapper.bgiframe=="function"){c.dropWrapper.bgiframe()}c.sourceSelect.change(function(i,h){if(h!="ddcl_internal"){c._sourceSelectChangeHandler(i)}});if(c.controlWrapper.parents("form.inGridForm").length==1){setTimeout(function(){c.drop()},1)}},_refreshOption:function(e,d,c){var b=e.parent();if(d){e.attr("disabled","disabled");e.removeClass("active");e.addClass("inactive");b.addClass("ui-state-disabled")}else{e.removeAttr("disabled");e.removeClass("inactive");e.addClass("active");b.removeClass("ui-state-disabled")}Durados.CheckBox.SetChecked(e,c)},_refreshGroup:function(c,b){if(b){c.addClass("ui-state-disabled")}else{c.removeClass("ui-state-disabled")}},refresh:function(){var b=this,e=this.sourceSelect,d=this.dropWrapper;var c=d.find("input");var g=d.find(".ui-dropdownchecklist-group");var h=0;var f=0;e.children().each(function(i){var j=a(this);var l=j.attr("disabled");if(j.is("option")){var k=j.attr("selected");var n=a(c[f]);b._refreshOption(n,l,k);f+=1}else{if(j.is("optgroup")){var o=j.attr("label");if(o!=""){var m=a(g[h]);b._refreshGroup(m,l);h+=1}j.children("option").each(function(s){var p=a(this);var r=(l||p.attr("disabled"));var q=p.attr("selected");var t=a(c[f+s]);b._refreshOption(t,r,q)})}}});b._updateControlText()},enable:function(){this.controlSelector.removeClass("ui-state-disabled");this.disabled=false},disable:function(){this.controlSelector.addClass("ui-state-disabled");this.disabled=true},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments);this.sourceSelect.css("display",this.initialDisplay);this.sourceSelect.attr("multiple",this.initialMultiple);this.controlWrapper.unbind().remove();this.dropWrapper.remove()},drop:function(){var b=this;b._toggleDropContainer(true)}});a.extend(a.ui.dropdownchecklist,{defaults:{width:null,maxDropHeight:null,firstItemChecksAll:false,closeRadioOnClick:false,minWidth:50,bgiframe:false}})})(jQuery);