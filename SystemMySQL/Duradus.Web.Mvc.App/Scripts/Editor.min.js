Durados.FieldEditor=function(){};Durados.FieldEditor.prototype.constructor=Durados.FieldEditor;Durados.FieldEditor.prototype.init=function(){};var prevField=null;Durados.FieldEditor.datePickerOff=true;Durados.FieldEditor.prototype.show=function(n,k,b,f,c){adjustDataTableHeightDisabled=true;var d=this.getElementContainer(k,b,n);var h=this;var a="f"+validationGuid;if(prevField!=null){if(prevField.params.element.hasClass("date")){Durados.FieldEditor.datePickerOff=true}prevField.elementChanged(prevField.params.element,prevField.params.cell,prevField.params.guid,prevField.params.name,prevField.params.pk,prevField.params.url,prevField.params.fieldJson,prevField.params.validation,prevField.params.elementContainer)}var g=this.getElement(d);if(g.length==0){return}var j=this.getElementType(g);if(!(j=="Text"||j=="DropDown"||j=="Check"||j=="InsideDependency"||j=="Autocomplete"||j=="CheckList"||j=="Url"||j=="Upload"||j=="TextArea")){return}var m=this.getLocation(n);var o=this.getSize(n);var i=this.getViewJson(k);var l=this.getFieldJson(b,i);this.showElement(d,o,m,n,k);if(j!="TextArea"){var e=getFieldValidation(l.Fields[0].Value,d.find("span:first").attr("id"),g)}this.params={element:g,cell:n,guid:k,name:b,pk:f,url:c,fieldJson:l,validation:e,elementContainer:d};prevField=h;this.bindElementBlur(g,n,k,b,f,c,l,e,d,validationGuid)};var elementGuid=0;var validationGuid=0;Durados.FieldEditor.prototype.getRichTextElement=function(a){var c=a.find(".richTextContainer");var b=$("<div/>").attr("type","textArea").attr("click","1").attr("d_val",a.attr("d_val")).click(function(){var e=a.attr("d_guid");var h=a.attr("d_name");var f=a.attr("d_val");var d=c.attr("rich")=="1";var g=function(j){b.attr("d_val",j);if(!d&&j.length>0){var k=c.attr("d_len");if(k>0&&j.length>k){j=j.substr(0,k)+"..."}}if(c.length==0){var i=a.find('img[fullUrl="yes"]:first');if(i.length==1){i.attr("src",j);i.parent("a:first").attr("href",j)}}else{c.children().first().html(j)}b.blur()};RichDialog.Open(h,false,d,e,f,g)});return b};Durados.FieldEditor.prototype.getUploadElement=function(b){var f=b.find("img");var d=b.find("a:first");var c=f.attr("fullUrl")=="yes";var e=$("<div/>").attr("type","upload").attr("click","1").attr("d_val",b.attr("d_val")).click(function(){var a=b.attr("d_guid");var l=b.attr("d_name");var j=views[a].ViewName;var h=b.attr("d_val");var i=f.attr("src");var g=null;var k=function(m,n){if(n!=null&&n!=""&&(m!=n||n.indexOf("http:")!=-1)||n.indexOf("https:")){f.attr("src",m)}else{f.remove()}if(c){e.attr("d_val",m);if(f.length==0){d.text(m)}}else{e.attr("d_val",n);if(m==n&&n.indexOf("http:")==-1&&n.indexOf("https:")==-1){d.text(n)}}e.blur()};g=RichDialog.OpenUploadDialog(j,l,a,k,h,i);updateDoanloadButton(a,g,h)});return e};function updateDoanloadButton(b,d,c){var e=d.find("a.uploadIcon");if(e.length>0){e.show();var a=e.attr("d_href");e.attr("href",a.replace("__filename__",encodeURI(c)))}}Durados.FieldEditor.prototype.getElementContainer=function(g,b,j){var f=this.getEditDialog(g);var e=f.find("[name='"+b+"']");var h=e.parents("td:first");var d="v"+validationGuid++;var i=$("<span id="+d+"></span>");if(e.hasClass("date")){var a=h.children();i.append('<input type="text" class="date" df="'+e.attr("df")+'"  dt="'+e.attr("dt")+'" />');if(a.length>2){i.append($(a[2]).clone())}}else{if(e.hasClass("uploadDiv")){e=this.getUploadElement(j);i.append(e)}else{if(e.is("textarea")){e=this.getRichTextElement(j);i.append(e)}else{if(e.is(":checkbox")){e.css("visibility","");i.append(e.clone())}else{i.html(h.html())}}}}var d="e"+elementGuid++;i.find(":first").attr("id",d);var c=$('<form id="f'+validationGuid+'" class="inGridForm"></form>');c.append(i);return c};Durados.FieldEditor.prototype.getElement=function(a){return a.find("span:first").children(":first-child")};Durados.FieldEditor.prototype.getEditDialog=function(a){var b=$("#"+a+"DataRowEdit");return b};Durados.FieldEditor.prototype.setValue=function(d,e,f){var c=this.getElementType(d);if(c=="Text"||c=="DropDown"||c=="InsideDependency"){d.val(e)}else{if(c=="CheckList"){d.find("option").each(function(){$(this).removeAttr("selected")});$(e.split(",")).each(function(){d.find("option[value='"+this+"']").attr("selected","selected")})}else{if(c=="Check"){Durados.CheckBox.SetChecked(d,e)}else{if(c=="Autocomplete"){SetAutoCompleteValueId(d,f,e)}else{if(c=="Url"){var b=d.find(".url");this.setUrl(b,e)}}}}}};Durados.FieldEditor.prototype.setUrl=function(b,f){var e="";var d="";var h="_blank";if(f!=null){var c=f.split("|");if(c.length==3){e=c[0];d=c[2];h=c[1]}else{if(c.length==1){d=c[0];e=c[0]}}}if(e==""&&d!="#"){e=d}var g=b.attr("format");if(g=="ButtonLink"){b.find("button span").text(e)}else{b.find("span").text(e)}b.attr("href",d);b.attr("target",h);b.attr("value",f)};Durados.FieldEditor.prototype.getElementType=function(a){if(a.attr("type")=="upload"){return"Upload"}else{if(a.attr("role")=="childrenCheckList"){return"CheckList"}else{if(a.attr("radioButtons")=="radioButtons"){return"Radio"}else{if(a.attr("outsideDependency")=="outsideDependency"){return"OutsideDependency"}else{if(a.attr("hasInsideTrigger")=="hasInsideTrigger"){return"InsideDependency"}}}}}if(a.attr("type")=="textArea"){return"TextArea"}else{if(a[0].type=="checkbox"){return"Check"}else{if(a.hasClass("Autocomplete")&&a.hasClass("ac_input")){return"Autocomplete"}else{if(a[0].type=="select-one"){return"DropDown"}else{if(a[0].type=="hidden"){return"Hidden"}else{if(a.find(".url").length==1){return"Url"}else{if(a.attr("color")=="1"){return"Color"}else{return"Text"}}}}}}}};Durados.FieldEditor.prototype.getLocation=function(a){return a.offset()};Durados.FieldEditor.prototype.getSize=function(a){return{width:a.width(),height:a.height()}};Durados.FieldEditor.prototype.handleKeys=function(g,k,i,b,f,c,j,e,d,a){var h=this;if(a.keyCode==$.ui.keyCode.ESCAPE){Durados.FieldEditor.datePickerOff=true;h.endEdit(d)}h.enter=a.keyCode==$.ui.keyCode.ENTER;if(h.enter){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();h.shift=a.shiftKey;if(g.hasClass("date")){g.datepicker("destroy");Durados.FieldEditor.datePickerOff=true}h.elementChanged(g,k,i,b,f,c,j,e,d)}h.tab=a.keyCode==$.ui.keyCode.TAB;if(h.tab){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();h.shift=a.shiftKey;if(g.hasClass("date")){g.datepicker("destroy");Durados.FieldEditor.datePickerOff=true}h.elementChanged(g,k,i,b,f,c,j,e,d)}};Durados.FieldEditor.prototype.bindElementBlur=function(f,k,i,a,e,b,j,d,c){var h=this.getElementType(f);var g=this;if(h=="Text"||h=="DropDown"||h=="Check"||h=="InsideDependency"||h=="Autocomplete"||h=="CheckList"||h=="Url"||h=="Upload"||h=="TextArea"){f.keydown(function(l){g.handleKeys(f,k,i,a,e,b,j,d,c,l)});if(h=="CheckList"){$(document).bind("keydown",function(l){g.handleKeys(f,k,i,a,e,b,j,d,c,l);if(!l.shiftKey){$(document).unbind("keydown")}})}else{$(document).unbind("keydown")}if(h=="Autocomplete"){if(f.attr("d_type")=="AutocompleteColumn"){f.blur(function(){if(!$(this).val()){g.endEdit(c)}})}$(Autocomplete).bind("result",function(m,l){g.elementChanged(f,k,i,a,e,b,j,d,c)})}else{f.blur(function(l){g.elementChanged(f,k,i,a,e,b,j,d,c)})}if(h=="Check"&&$.browser.webkit){f.mousedown(function(n){var m=f.attr("checked");var l=m?"":"checked";f.attr("checked",l)})}}};Durados.FieldEditor.prototype.getInsideDependencyFK=function(c,a){var d=a.parent();var b=c.attr("triggerName");if(b==null||b==""){return null}var f=d.find('td[d_name="'+b+'"]');var e=f.attr("d_val");return e};Durados.FieldEditor.prototype.loadInsideDependency=function(d,c,a){var b=a.attr("d_guid");var f=a.attr("d_name");var e=views[b].ViewName;Dependency.Load(e,f,d,c,b)};Durados.FieldEditor.prototype.showElement=function(c,q,l,n,g){var e=this.getElement(c);var p=e.attr("click")=="1";if(p){e.click();return}n.children().first().hide();n.css("padding","0px 5px");n.removeAttr("onmousedown");n.append(c);var b=q.width+5;var h=l.top+(n.innerHeight()-e.height()-2)/2;adjustDataTableHeightDisabled=true;var j=c.find("input:checkbox:first");j.checkbox({cls:"jquery-safari-checkbox"});var f=this.getElementType(e);if(f=="Text"||f=="DropDown"||f=="Check"||f=="CheckList"||f=="InsideDependency"||f=="Autocomplete"){if(f=="Text"){if($.browser.msie){b-=4;h-=1}}else{if(f=="DropDown"||f=="CheckList"){if($.browser.msie){b-=1;h-=1}}else{if(f=="Check"){c.css({padding:"2px"});if($("body").attr("dir")=="rtl"){l.left+=b-15}}else{if(f=="Autocomplete"){Autocomplete.InitElement(e,g)}else{if(f=="InsideDependency"){var m=this.getInsideDependencyFK(e,n);if(m==null||m==""){c.remove();return}this.loadInsideDependency(m,e,n)}}}}}if(f!="Check"){e.width(b)}else{l.left=n.find("span").offset().left-8}}var o=null;if(f=="Url"){c.css("margin","5px")}else{if(f=="Upload"){n.css("padding","0px")}else{if(f=="Text"||f=="Autocomplete"){c.find("input").css("text-align",n.find("div:first").css("text-align"));if(f=="Autocomplete"){o=this.getCellDisplayValue(n)}}}}var k=this.getCellValue(n,f);this.setValue(e,k,o);if(f=="CheckList"){initDropdownchecklist(e,g,b);adjustDataTableHeightDisabled=false}else{if(f=="Check"&&$.browser.webkit&&false){adjustDataTableHeightDisabled=false}else{setTimeout(function(){e.focus();setTimeout(function(){e.select();adjustDataTableHeightDisabled=false},20)},10)}}if(e.hasClass("date")){triggerDateChanged(e);var d=num(DateFormats.getValidDateType(e.attr("df")));var i=duradosGetJQueryDateFormat(e.attr("df"),d);switch(d){case DateFormats.dateType.dateOnly:e.datepicker({showButtonPanel:true,showOn:"focus",beforeShow:datePickerBeforeShow,onChangeMonthYear:datePickerOnChangeMonthYear,dateFormat:i.dateFormat,onClose:function(r,a){Durados.FieldEditor.datePickerOff=true;$(a.input).blur()}});break;case DateFormats.dateType.dateAndTime:e.datetimepicker({showButtonPanel:true,showOn:"focus",beforeShow:datePickerBeforeShow,onChangeMonthYear:datePickerOnChangeMonthYear,dateFormat:i.dateFormat,timeFormat:i.timeFormat,onClose:function(r,a){Durados.FieldEditor.datePickerOff=true;$(a.input).blur()}});break;case DateFormats.dateType.timeOnly:e.timepicker({showButtonPanel:true,showOn:"focus",beforeShow:datePickerBeforeShow,onChangeMonthYear:datePickerOnChangeMonthYear,timeFormat:i.timeFormat,onClose:function(r,a){Durados.FieldEditor.datePickerOff=true;$(a.input).blur()}});break;default:break}Durados.FieldEditor.datePickerOff=false}};Durados.FieldEditor.prototype.endEdit=function(c){if(!Durados.FieldEditor.datePickerOff){return}if(c.find(".date").length){c.find(".date").datepicker("destroy")}var a=c.parent("td");var b=this.getElement(c);if(b.attr("type")!="upload"){a.css("padding","0px 10px")}a.attr("onmousedown","Durados.FieldEditor.Show(this, event);");c.hide();c.remove();Durados.FieldEditor.cancel=false;a.children().first().show()};Durados.FieldEditor.prototype.elementChanged=function(b,a,o,r,p,f,q,j,e){prevField=null;var i="";if(!Durados.FieldEditor.datePickerOff&&b.hasClass("date")&&b.datepicker("widget").is(":visible")){return}var m=this.getElementType(b);try{if(j&&!j.validate()){setTimeout(function(){b.focus()},1);Durados.FieldEditor.cancel=true;return false}}catch(g){}var n=this.getElementValue(b,m);q.Fields[0].Value.Value=n;var l=this.getCellValue(a,m);var h=this.getCellDisplayValue(a);var c=this.getElementDisplayValue(b);if(l!=n){this.setCellValue(a,n,c,l,h,m)}if(b.hasClass("date")){Durados.FieldEditor.datePickerOff=true;triggerDateChanged(b,a)}this.endEdit(e);var k=null;if(this.tab){if(this.shift){k=this.getPrevCell(a)}else{k=this.getNextCell(a)}}else{if(this.enter){if(this.shift){k=this.getAboveCell(a)}else{k=this.getBellowCell(a)}}}if(k){if(Durados.GridHandler.insertElementIntoViewport(k)){}setTimeout(function(){var s=k;s.mousedown()},40)}if(l==n){return}var d=this;$.post(f,{pk:p,jsonView:Sys.Serialization.JavaScriptSerializer.serialize(q),guid:o},function(v){if(v!="success"){d.setCellValue(a,l,h,n,c,m);ajaxNotSuccessMsg(v);return}var s=a.attr("d_refresh")=="d_refresh";if(s){setTimeout(function(){var x=Data.GetScalar(views[o].ViewName,p,r,o);d.setCellValue(a,n,x,l,h,m)},1)}var t=a.attr("d_hasCss")=="d_hasCss";if(t){var u=a.attr("class");var w=u.replace(" "+l+" "," "+n+" ");a.removeClass(u);a.addClass(w)}if(views[o].updateParent){if(a.attr("updateParent")=="updateParent"){updateParent(o)}}})};Durados.FieldEditor.prototype.getElementValue=function(c,d){if(d=="Text"||d=="DropDown"||d=="InsideDependency"){return c.val()}else{if(d=="CheckList"){var f=c.val();if(f==null){return""}else{var e=f.toString();if(e.substr(0,1)==","){e=e.substring(1)}return e}}else{if(d=="Check"){return Durados.CheckBox.IsChecked(c)}else{if(d=="Autocomplete"){if(c.attr("d_type")=="AutocompleteColumn"){return c.val()}else{return GetAutoCompleteValueId(c)}}else{if(d=="Url"){var b=c.find(".url");return b.attr("value")}else{if(d=="Upload"||d=="TextArea"){return c.attr("d_val")}}}}}}return null};Durados.FieldEditor.prototype.isTextArea=function(a){return a.attr("textArea")=="textArea"};Durados.FieldEditor.prototype.getNextCell=function(a){var d=this;var c=a.next();var e=a.parent();var f=false;while(!f){if(c.length>0){if(c.attr("d_role")=="cell"){return c}else{c=c.next()}}else{f=true}}if(f){var b=e.next();if(b.length==0){return null}c=b.find('td[d_role="cell"]:first');if(c.length>0){$(Durados.View).trigger("rowChanged",{row:c,originalCell:a,tr:b});return c}}return c};Durados.FieldEditor.prototype.getPrevCell=function(a){var b=this;var d=a.prev();var e=a.parent();var f=false;while(!f){if(d.length>0){if(d.attr("d_role")=="cell"){return d}else{d=d.prev()}}else{f=true}}if(f){var c=e.prev();if(c.length==0||c.attr("d_row")==null){return null}d=c.find('td[d_role="cell"]:last');if(d.length>0){$(Durados.View).trigger("rowChanged",{row:d,originalCell:a,tr:c});return d}}return d};Durados.FieldEditor.prototype.getBellowCell=function(a){var d=this;var e=a.parent();var c=e.children("td").index(a);var b=e;var g=false;while(!g){var b=b.next();if(b.length==0){b=e.parent().children('tr[d_row="d_row"]:first')}var f=b.children("td:eq("+c+")");if(f.attr("d_role")=="cell"){$(Durados.View).trigger("rowChanged",{row:f,originalCell:a,tr:e});if(e.attr("id")==b.attr("id")){return null}else{return f}}}return null};Durados.FieldEditor.prototype.getAboveCell=function(b){var d=this;var f=b.parent();var c=f.children("td").index(b);var e=f;var g=false;while(!g){var e=e.prev();if(e.length==0){e=f.parent().children('tr[d_row="d_row"]:last')}var a=e.children("td:eq("+c+")");if(a.attr("d_role")=="cell"){$(Durados.View).trigger("rowChanged",{row:a,originalCell:b,tr:f});if(f.attr("id")==e.attr("id")){return null}else{return a}}}return null};Durados.FieldEditor.prototype.isValid=function(a,b){return true};Durados.FieldEditor.prototype.getCellValue=function(a,b){if(b=="Text"||b=="DropDown"||b=="InsideDependency"||b=="Autocomplete"||b=="CheckList"||b=="Url"||b=="Upload"||b=="TextArea"){return a.attr("d_val")}else{if(b=="Check"){return a.attr("d_val")=="Yes"}}return null};Durados.FieldEditor.prototype.getCellDisplayValue=function(b){var e=b.find("div:first");var c=e.find("a");if(c.length==0){var d=e.find("span");if(d.length==0){if(!e.length){e=b}return e.text()}else{return d.text()}}else{return c.text()}};Durados.FieldEditor.prototype.setCellValue=function(o,m,i,g,p,j){o.attr("d_val",m);var c=o.find("div:first");if(!c.length){c=o}if(j=="Text"){c.text(i)}else{if(j=="DropDown"||j=="InsideDependency"||j=="Autocomplete"||j=="CheckList"){var k=c.find("a");if(k.length==0){var l=c.find("span");if(l.length==0){c.text(i)}else{var d=o.attr("limit");if(d!=null&&d!=""){d=parseInt(d);var n=i.split(",");if(d>0){l.attr("alt",i);l.attr("title",i)}if(d>0&&n.length>d){var e="";for(var f=0;f<d;++f){e=e+n[f]+","}e=e.slice(0,-1)+"...";l.text(e)}else{l.text(i)}}else{l.text(i)}}}else{k.text(i);if(k.attr("d_role")=="parentTableView"){var b=k.attr("d_url");b=b.replace("__="+p,"__="+i);b=b.replace("="+g,"="+m);k.attr("d_url",b)}else{k.attr("pk",m)}}}else{if(j=="Check"){o.attr("d_val",m?"Yes":"No");var q=m?String("&#8730;"):"&nbsp;";var h=m?"checked":"not-checked";c.html("<span class='"+h+"'>"+q+"</span>")}else{if(j=="Url"){var k=o.find(".url");this.setUrl(k,m)}else{}}}}if(i!=p){Durados.GridHandler.setHeaderWidth(o)}};Durados.FieldEditor.prototype.getElementDisplayValue=function(b){var a=this.getElementType(b);if(a=="Text"||a=="Autocomplete"){return b.val()}else{if(a=="DropDown"||a=="InsideDependency"){return b.find("option:selected").text()}else{if(a=="CheckList"){var c="";b.find("option:selected").each(function(){if($(this).text()!="(All)"){c=c+$(this).text()+","}});if(c!=""){c=c.slice(0,-1)}return c}else{return""}}}};Durados.FieldEditor.prototype.getViewJson=function(a){return GetJsonViewForEdit(a)};Durados.FieldEditor.prototype.getFieldJson=function(d,h){var b=jQuery.extend(true,{},h);b.Fields=[];for(var c=0,a=h.Fields.length;c<a;++c){var g=h.Fields[c];if(g.Key==d){var e=jQuery.extend(true,{},g);b.Fields[0]=e;break}}return b};Durados.CellFieldEditor=function(){};Durados.CellFieldEditor.prototype=new Durados.FieldEditor;Durados.CellFieldEditor.prototype.constructor=Durados.CellFieldEditor;Durados.CellFieldEditor.prototype.init=function(){Durados.FieldEditor.prototype.init.call(this)};Durados.CellFieldEditor.prototype.show=function(a,d,c,e,b){Durados.FieldEditor.prototype.show.call(this,a,d,c,e,b)};Durados.FieldEditor.CloseAllEditors=function(){var a=Durados.FieldEditor.prototype;$("form.inGridForm").each(function(){a.endEdit($(this))});Durados.FieldEditor.cancel=false};Durados.FieldEditor.MouseDown=function(a,b){a=a||event;$(document).mousedown();if(isRightClick(a)){Durados.FieldEditor.CloseAllEditors()}return true};function isRightClick(a){if(window.event){if(window.event.button==2){return true}}else{if(a&&a.which&&a.which==3){return true}}return false}function isLeftClick(b){var d=(navigator.appVersion.indexOf("MSIE 7.")==-1)?false:true;var c=(navigator.appVersion.indexOf("MSIE 7.")==-1)?false:true;var a=d||c;return(!a&&b.button==0)||(a&&b.button==1)}Durados.FieldEditor.setFocus=function(){$("table.toolbar:first").focus()};Durados.FieldEditor.Show=function(n,l){l=l||event;var k=new Durados.CellFieldEditor();if(Durados.FieldEditor.cancel){Durados.FieldEditor.setFocus();return}if($(n).attr("d_role")!="cell"){Durados.FieldEditor.setFocus();return}var a=false;var f=false;if(l&&l.ctrlKey){a=true}else{if(l&&l.shiftKey){f=true}}var m=$(n).attr("d_guid");var d=$(n).attr("d_name");var j=$(n).attr("d_pk");var h=$(n).attr("d_derivation");var i=h=="disabled";var c=views[m].EditOnlyUrl;var b=$("#"+m+"Safety");if(b.length){var g=Durados.CheckBox.IsChecked($("#"+m+"Safety"));if(!g){return}}cellsSelection.cellClicked(n,l,a,f);if(l&&(a||f)){return}if(isRightClick(l)){return}if(k&&!i){k.show($(n),m,d,j,c)}return k};Durados.FieldEditor.setCellValue=function(f,d,g,k,b){var l=f;var i=new Durados.CellFieldEditor();var e=i.getElementContainer(k,b,l);var h=i.getElement(e);if(h.length==0){return}var j=i.getElementType(h);var a=i.getCellValue(l,j);var c=i.getCellDisplayValue(l);i.setCellValue(l,d,g,a,c,j)};Durados.FieldEditor.GetType=function(a){return"Cell"};Durados.CellsSelection=function(){if(this.clear){this.clear()}};Durados.CellsSelection.prototype.constructor=Durados.CellSelection;Durados.CellsSelection.prototype.clear=function(){this.clearWithoutShow();this.show()};Durados.CellsSelection.prototype.clearWithoutShow=function(){this.rows=new Array();this.firstCell=null;this.firstRow=null};Durados.CellsSelection.prototype.cellClicked=function(d,c,b,a){if(a){Durados.FieldEditor.CloseAllEditors();this.addRect(d)}else{if(b){Durados.FieldEditor.CloseAllEditors();this.addCell(d,true)}else{if(isRightClick(c)&&$(d).hasClass("selectedCell")){return}this.select(d)}}};Durados.CellsSelection.prototype.select=function(c){this.clearWithoutShow();var a=new Durados.Cell(c);var b=new Durados.Row(a.GetTR());b.GetCells().push(a);this.firstCell=a;this.firstRow=b;this.rows.push(b);this.show()};Durados.CellsSelection.prototype.selectCurrentRow=function(){var b=this.GetGuid();if(b==null){return}var a=Multi.GetSelection(b);var c;if(a.length==1){c=Multi.GetElementByPK(b,a[0])}else{return}this.addRow($(c).parents("tr[d_row='d_row']:first"))};Durados.CellsSelection.prototype.addRow=function(d){var e=new Durados.Row(d);this.rows.push(e);var c=d.children("td");for(var b=0;b<c.length;b++){var a=e.GetCell(b);if(a!=null){e.GetCells().push(a)}}this.show()};Durados.CellsSelection.prototype.addCell=function(d,b){if(this.rows.length!=1&&b){this.select(d);return}var c=this.rows[0];var a=new Durados.Cell(d);if(!(a.GetPK()==c.GetPK()&&a.GetGuid()==c.GetGuid())){this.select(d);return}c.GetCells().push(a);this.show()};Durados.CellsSelection.prototype.addRect=function(a){var l=this.firstRow;if(l==null||this.rows.length==0){this.select(a);return}var j=this.firstCell;if(j==null||l.GetCells().length==0){this.select(a);return}var h=new Durados.Cell(a);var i=new Durados.Row(h.GetTR());if(l.GetGuid()!=i.GetGuid()){this.select(a);return}var g=l.GetIndex();var f=i.GetIndex();var c=j.GetIndex();var b=h.GetIndex();if(g==f&&c==b){this.select(a);return}this.rows=new Array();if(g>f){var m=g;g=f;f=m}if(c>b){var m=c;c=b;b=m}for(var e=g;e<=f;e++){var n=this.GetRow(e);this.rows.push(n);for(var d=c;d<=b;d++){var k=n.GetCell(d);if(k!=null){n.GetCells().push(k)}}}this.show()};Durados.CellsSelection.prototype.GetTable=function(){if(this.firstRow==null){return null}return this.firstRow.GetTable()};Durados.CellsSelection.prototype.GetTR=function(a){var b=this.GetTable();if(b==null){return null}return b.children("tr:eq("+a+")")};Durados.CellsSelection.prototype.GetRows=function(){return this.rows};Durados.CellsSelection.prototype.GetRow=function(a){var b=this.GetTR(a);var c=new Durados.Row(b);if(c.pk==null){return null}return c};Durados.CellsSelection.prototype.GetGuid=function(){if(this.rows.length>0){return this.rows[0].guid}else{return null}};Durados.CellsSelection.prototype.copy=function(n){if(n==null||n.rows==null){return false}var o=n.rows.length;if(this.rows==null){return false}var k=this.rows.length;if(o==0||k==0){return false}var f=k%o;if(f!=0){return false}var e=k/o;for(var g=0;g<e;g++){for(var b=0;b<o;b++){var d=n.rows[b];var j=this.rows[e*g+b];for(var l=0;l<d.cells.length;l++){var a=d[l];var h=j[l]}}}};Durados.CellsSelection.prototype.show=function(){var a="selectedCell";$("."+a).removeClass(a);var b=this.GetGuid();if(this.rows.length>0){$("#"+b+"ajaxDiv").find("input.Multi:checked").each(function(){if($(this).parents("tr").first().attr("guid")==b){Durados.CheckBox.SetChecked($(this),"")}})}$(this.rows).each(function(){var c=this;if(views[c.guid].MultiSelect){c.GetTR().find("input.Multi:first").attr("checked",true)}$(c.GetCells()).each(function(){var d=this;d.GetTD().addClass(a)})});this.showBorder("");if(b!=null&&views[b].MultiSelect){setTimeout(function(){Multi.MarkSelection(b)},1)}$(Durados.CellsSelection).trigger("onchanged",{cellsSelection:this})};Durados.CellsSelection.prototype.showCopy=function(){$("td.selectedCell").removeClass("selectedCell");this.showBorder("Copy")};Durados.CellsSelection.prototype.showBorder=function(e){this.hideBorder(e);var p=this.rows.length;var f=$("body").attr("dir")=="rtl";if(f){var q="borderCellRight"+e;var s="borderCellLeft"+e}else{var q="borderCellLeft"+e;var s="borderCellRight"+e}if(p>1){for(var m=0;m<p;m++){var g=this.rows[m];var k=m==0;var i=m==this.rows.length-1;for(var u=0;u<g.cells.length;u++){var d=u==0;var t=u==g.cells.length-1;var b=g.cells[u];var h=b.GetTD();var j=b.GetIndex();if(k){h.addClass("borderCellTop"+e);var a=g.tr.prev();if(a.length==1){a.children("td:eq("+j+")").addClass("borderCellBottom"+e)}}if(i){h.addClass("borderCellBottom"+e);var a=g.tr.next();if(a.length==1){a.children("td:eq("+j+")").addClass("borderCellTop"+e)}}if(d){h.addClass(q);var n=h.prev();if(n.length==1){n.addClass(s)}}if(t){h.addClass(s);var o=h.next();if(o.length==1){o.addClass(q)}}}}}else{$(this.rows).each(function(){var E=this;var l=E.cells.sort(compareCells).length;if(l<=1){return}for(var A=0;A<l;A++){var D=E.cells[A];var x=D.GetTD();var B=D.GetIndex();var C=A==E.cells.length-1;var r=A==0;if(C){x.addClass(s);var z=x.next();if(z.length==1){z.addClass(q)}}if(r){x.addClass(q);var w=x.prev();if(w.length==1){w.addClass(s)}}x.addClass("borderCellBottom"+e);var y=E.tr.next();if(y.length==1){y.children("td:eq("+B+")").addClass("borderCellTop")}x.addClass("borderCellTop"+e);var v=E.tr.prev();if(v.length==1){v.children("td:eq("+B+")").addClass("borderCellBottom")}}})}};Durados.CellsSelection.prototype.hideBorder=function(a){$("td.borderCell"+a).removeClass("borderCell"+a);$("td.borderCellTop"+a).removeClass("borderCellTop"+a);$("td.borderCellBottom"+a).removeClass("borderCellBottom"+a);$("td.borderCellLeft"+a).removeClass("borderCellLeft"+a);$("td.borderCellRight"+a).removeClass("borderCellRight"+a)};Durados.CellsSelection.prototype.hideCopy=function(){this.hideBorder("Copy")};Durados.CellsSelection.prototype.clone=function(){return jQuery.extend(true,{},this)};Durados.Cell=function(a){this.td=$(a);this.name=this.td.attr("d_name");this.val=this.td.attr("d_val");this.pk=this.td.attr("d_pk");this.guid=this.td.attr("d_guid")};Durados.Cell.prototype.constructor=Durados.Cell;Durados.Cell.prototype.GetName=function(){return this.name};Durados.Cell.prototype.GetValue=function(){return this.val};Durados.Cell.prototype.GetPK=function(){return this.pk};Durados.Cell.prototype.GetGuid=function(){return this.guid};Durados.Cell.prototype.GetIndex=function(){return this.GetTR().children("td").index(this.GetTD())};Durados.Cell.prototype.GetTR=function(){return this.GetTD().parent()};Durados.Cell.prototype.GetTD=function(){return this.td};Durados.Row=function(a){this.cells=new Array();this.tr=a;this.pk=this.tr.attr("d_pk");this.guid=this.tr.attr("guid")};Durados.Row.prototype.constructor=Durados.Row;Durados.Row.prototype.GetPK=function(){return this.pk};Durados.Row.prototype.GetGuid=function(){return this.guid};Durados.Row.prototype.GetTR=function(){return this.tr};Durados.Row.prototype.GetTable=function(){return this.GetTR().parent()};Durados.Row.prototype.GetIndex=function(){return this.GetTable().children("tr").index(this.GetTR())};Durados.Row.prototype.GetCells=function(){return this.cells};Durados.Row.prototype.GetTD=function(a){var b=this.GetTR();return b.children("td:eq("+a+")")};Durados.Row.prototype.GetCell=function(b){var c=this.GetTD(b);if(c.attr("d_role")!="cell"){return null}var a=new Durados.Cell(c);return a};function compareCells(b,a){return b.GetIndex()-a.GetIndex()}var d_copy=null;$(document).ready(function(){$(document).keyup(function(b){var a=b.which;if(b.ctrlKey){if(a=="67"){if(copyPaste!=null){copyPaste.copy()}}else{if(a=="86"){if(copyPaste!=null){copyPaste.paste()}}}}else{if(a=="27"){if(cellsSelection!=null){cellsSelection.clear()}if(d_copy!=null){d_copy.hideCopy();d_copy=null}}}})});Durados.CopyPaste=function(b){this.copyButtons=$("a.copyButton");this.pasteButtons=$("a.pasteButton");this.cellsSelction=null;var a=this;var c=Durados.CheckBox.IsChecked($("#"+b+"Safety"));if(c){this.enableCopy(true);this.copyButtons.each(function(){$(this).unbind("click");$(this).one("click",function(){a.copy();return false})})}else{this.enableCopy(false)}this.pasteButtons.each(function(){a.enablePaste(false);$(this).unbind("click");$(this).one("click",function(){a.paste();return false})});$(Durados.CellsSelection).bind("onchanged",function(){if(d_copy!=null){a.enablePaste(true)}});this.validationMessages=[];this.validationMessages.push("The area you selected to copy does not match the paste area. The operation was canceled.");this.validationMessages.push("You are about to paste on an area of #cols columns by #rows rows. Please confirm.");this.validationMessages.push("You are about to paste on an area of #cols columns by #rows rows. Please confirm.");this.validationMessages.push("You are about to paste on an area of #cols columns by #rows rows. Please confirm.");this.validationMessages.push("You are about to paste on an area of #cols columns by #rows rows. Please confirm.");this.validationMessages.push("Please confirm a paste of a single cell.");this.validationMessages.push("You are about to paste on an area of #cols columns by #rows rows. Please confirm.")};Durados.CopyPaste.prototype.constructor=Durados.CopyPaste;Durados.CopyPaste.prototype.enableAction=function(c,b){var a=this;c.each(function(){if($(this).attr("type")=="button"){a.enableButton($(this),b)}else{a.enableElement($(this),b)}})};Durados.CopyPaste.prototype.enableCopy=function(a){this.enableAction(this.copyButtons,a)};Durados.CopyPaste.prototype.enablePaste=function(a){this.enableAction(this.pasteButtons,a)};Durados.CopyPaste.prototype.enableButton=function(b,a){b.attr("disabled",a)};Durados.CopyPaste.prototype.enableElement=function(b,a){if(a){b.removeClass("disablePaste");b.unbind("click");b.one("click",function(){copyPaste.paste();return false})}else{b.addClass("disablePaste");b.unbind("click");b.one("click",function(){return false})}};Durados.CopyPaste.prototype.copy=function(){if(cellsSelection.GetRows().length==0){return}d_copy=cellsSelection.clone();this.enablePaste(false);d_copy.showCopy()};Durados.CopyPaste.prototype.paste=function(){if(d_copy==null){return}var b=cellsSelection;if(!b.rows||!b.rows[0]){return}var f=this.validation(d_copy,b);var j=this.validationMessages[f];var d=b.rows.length;var e=d_copy.rows.length;var c=b.rows[0].cells.length;var i=d_copy.rows[0].cells.length;if(f==2){d=e;c=i}if(f==6){c=i}j=j.replace("#cols",c);j=j.replace("#rows",d);var g=b.GetGuid();if(g==null){return}if(f==0){alert(j);return}else{if(!confirm(j)){return}}var a=this.getJson(d_copy,b,f);var h=views[g].ViewName;saveElementScrollsPosition("");showProgress();$.post(rootPath+views[g].Controller+"/CopyPaste/"+h,{jsonView:Sys.Serialization.JavaScriptSerializer.serialize(a),guid:g},function(m){var n=m.indexOf("$$error$$",0);var o=m.indexOf("$$message$$",0);var k=n>0&&n<1000;var l=o>0&&o<1000;if(k){ajaxNotSuccessMsg(m,g)}else{if(l){ajaxNotSuccessMsg(m,g);refreshView()}else{EditDialog.HandleSuccess(m,g);d_copy.hideCopy()}}resetElementScrollsPosition("")})};Durados.CopyPaste.prototype.validation=function(a,b){if(a==null||a.rows==null){return 0}if(b==null||b.rows==null){return 0}var f=a.rows.length;var e=b.rows.length;if(f==0||e==0){return 0}var m=a.rows[0].cells.length;var c=b.rows[0].cells.length;if(m==0||c==0){return 0}if(a.rows[0].cells[0].name!=b.rows[0].cells[0].name){return 0}if(c==1&&e==1){if(m==1&&f==1){return 5}else{var j=b.rows[0].GetIndex();var h=j+f-1;var l=b.GetRow(h);if(l==null){return 0}else{if(f>1){var k=a.rows[0].cells[m-1].GetIndex();var d=l.GetCell(k).td;b.addRect(d)}else{$(a.rows[0].cells).each(function(){var i=this;if(a.rows[0].cells[0]!=i){var n=i.GetIndex();b.addCell(l.GetCell(n).td,true)}})}return 2}}}if(c!=m){if(c!=1){return 0}else{if(a.rows[0].cells[0].name!=b.rows[0].cells[0].name){return 0}return 6}}for(var g=0;g<a.rows[0].cells.length;g++){if(a.rows[0].cells[g].name!=b.rows[0].cells[g].name){return 0}}if(f==e){return 1}if(e%f==0){return 4}else{return 0}};Durados.CopyPaste.prototype.getJson=function(d,b,a){var c={Source:{FieldsNames:[],FieldsValues:[]},Destination:{RowsPKs:[]}};if(d.rows.length==0){return c}$(d.rows[0].cells).each(function(){c.Source.FieldsNames.push(this.name)});$(d.rows).each(function(){var e=[];$(this.cells).each(function(){e.push(this.val)});c.Source.FieldsValues.push(e)});$(b.rows).each(function(){c.Destination.RowsPKs.push(this.pk)});return c};