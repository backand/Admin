(function(){var j=document,n=window;function b(d){if(typeof d=="string"){d=j.getElementById(d)}return d}var j=document,n=window;if($.browser.mozilla){function f(d){try{var u=$(d._parentDialog);var t=u.find("#idInputFile");if(t.length>0){u.remove("#idInputFile")}return true}catch(s){return false}}function e(d){try{var t=$(d._parentDialog).find("#idInputFile");if(t.length>0){d._input=t[0]}return t}catch(s){return null}}}function p(d){try{if(d.stopPropagation){d.stopPropagation()}else{if(d.preventDefault){d.preventDefault()}else{if(d.stopImmediatePropagation){d.stopImmediatePropagation()}else{d.cancelBubble=true}}}}catch(s){}return true}function g(t,s,d){if(n.addEventListener){t.addEventListener(s,d,false)}else{if(n.attachEvent){var u=function(){d.call(t,n.event)};t.attachEvent("on"+s,u)}}}var c=function(){var d=j.createElement("div");return function(s){d.innerHTML=s;var t=d.childNodes[0];d.removeChild(t);return t}}();function h(s,d){return s.className.match(new RegExp("(\\s|^)"+d+"(\\s|$)"))}function i(s,d){if(!h(s,d)){s.className+=" "+d}}function o(t,d){var s=new RegExp("(\\s|^)"+d+"(\\s|$)");t.className=t.className.replace(s," ")}if(document.documentElement.getBoundingClientRect){var q=function(d){var w=d.getBoundingClientRect(),A=d.ownerDocument,x=A.body,s=A.documentElement,v=s.clientTop||x.clientTop||0,y=s.clientLeft||x.clientLeft||0,B=1;if(x.getBoundingClientRect){var u=x.getBoundingClientRect();B=(u.right-u.left)/x.clientWidth}if(B>1){v=0;y=0}var z=w.top/B+(window.pageYOffset||s&&s.scrollTop/B||x.scrollTop/B)-v,t=w.left/B+(window.pageXOffset||s&&s.scrollLeft/B||x.scrollLeft/B)-y;return{top:z,left:t}}}else{var q=function(d){if(n.jQuery){return jQuery(d).offset()}var t=0,s=0;do{t+=d.offsetTop||0;s+=d.offsetLeft||0}while(d=d.offsetParent);return{left:s,top:t}}}function a(t){var s,d,u;if($("body").attr("dir")!="rtl"){u=q(t);s=u.left+t.offsetWidth-100;d=u.top+t.offsetHeight}else{u=q(t);s=u.left+t.offsetWidth;d=u.top+t.offsetHeight}return{left:u.left,right:s,top:u.top,bottom:d}}function l(u){if(!u.pageX&&u.clientX){var t=1;var d=document.body;if(d.getBoundingClientRect){var s=d.getBoundingClientRect();t=(s.right-s.left)/d.clientWidth}return{x:u.clientX/t+j.body.scrollLeft+j.documentElement.scrollLeft,y:u.clientY/t+j.body.scrollTop+j.documentElement.scrollTop}}return{x:u.pageX,y:u.pageY}}var k=function(){var d=0;return function(){return"ValumsAjaxUpload"+d++}}();function r(d){return d.replace(/.*(\/|\\)/,"")}function m(d){return(/[.]/.exec(d))?/[^.]+$/.exec(d.toLowerCase()):""}Ajax_upload=AjaxUpload=function(t,d){if(t.jquery){t=t[0]}else{if(typeof t=="string"&&/^#.*/.test(t)){t=t.slice(1)}}t=b(t);this._input=null;this._button=t;this._disabled=false;this._submitting=false;this._justClicked=false;this._parentDialog=j.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var u=jQuery(this._button).parents(".ui-dialog");if(u.length){this._parentDialog=u[0]}}this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:true,responseType:false,onChange:function(v,w){},onSubmit:function(v,w){},onComplete:function(w,v){}};for(var s in d){this._settings[s]=d[s]}this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(d){this._settings.data=d},disable:function(){this._disabled=true},enable:function(){this._disabled=false},destroy:function(){if(this._input){if(this._input.parentNode){this._input.parentNode.removeChild(this._input)}this._input=null}},_createInput:function(){var s=this;if($.browser.mozilla){f(s)}var d=j.createElement("input");if($.browser.mozilla){d.setAttribute("id","idInputFile")}d.setAttribute("type","file");d.setAttribute("name",this._settings.name);var u=null;if($.browser.mozilla){u={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"100px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none"}}else{u={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"100px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:999999999}}if($("body").attr("dir")=="rtl"){u.margin="0"}for(var t in u){d.style[t]=u[t]}if(!(d.style.opacity==="0")){d.style.filter="alpha(opacity=0)"}this._parentDialog.appendChild(d);g(d,"change",function(){var v=r(this.value);if(s._settings.onChange.call(s,v,m(v))==false){return}if(s._settings.autoSubmit){s.submit()}});g(d,"click",function(v){s.justClicked=true;setTimeout(function(){s.justClicked=false},2500);if($.browser.mozilla){return p(v)}});this._input=d},_rerouteClicks:function(){var s=this;var t,d={top:0,left:0},u=false;g(s._button,"mouseover",function(v){if(!s._input||u){return}u=true;t=a(s._button);if(s._parentDialog!=j.body){d=q(s._parentDialog)}});g(document,"mousemove",function(x){var w=s._input;if(!w||!u){return}if(s._disabled){o(s._button,"hover");w.style.display="none";return}var z=l(x);var y=t.right-t.left;if((z.x+3>=t.left)&&(z.x-3<=t.right)&&(z.y+6>=t.top)&&(z.y-6<=t.bottom)){if($("body").attr("dir")=="rtl"){w.style.left=(z.x-d.left-15)+"px"}else{w.style.left=z.x-d.left+120+"px"}w.style.top=z.y-d.top-6+"px";w.style.display="block";i(s._button,"hover")}else{u=false;var v=setInterval(function(){if(s.justClicked){return}if(!u){w.style.display="none"}clearInterval(v)},25);o(s._button,"hover")}})},_createIframe:function(){var s=k();var d=c('<iframe src="javascript:false;" name="'+s+'" />');d.id=s;d.style.display="none";j.body.appendChild(d);return d},submit:function(){var d=this,u=this._settings;if(this._input.value===""){return}var s=r(this._input.value);if(!(u.onSubmit.call(this,s,m(s))==false)){var t=this._createIframe();var w=this._createForm(t);w.appendChild(this._input);w.submit();j.body.removeChild(w);w=null;this._input=null;this._createInput();var v=false;g(t,"load",function(A){if(t.src=="javascript:'%3Chtml%3E%3C/html%3E';"||t.src=="javascript:'<html></html>';"){if(v){setTimeout(function(){j.body.removeChild(t)},0)}return}var z=t.contentDocument?t.contentDocument:frames[t.id].document;if(z.readyState&&z.readyState!="complete"){return}if(z.body&&z.body.innerHTML=="false"){return}var y=$(z.body).text();if(!y){return}var x;if(z.XMLDocument){x=z.XMLDocument}else{if(z.body){x=$.trim(y);if(u.responseType&&u.responseType.toLowerCase()=="json"){if(z.body.firstChild&&z.body.firstChild.nodeName.toUpperCase()=="PRE"){x=z.body.firstChild.firstChild.nodeValue}if(x){x=window["eval"]("("+x+")")}else{x={}}}}else{var x=z}}u.onComplete.call(d,s,x);v=true;t.src="javascript:'<html></html>';"})}else{if(!$.browser.mozilla){j.body.removeChild(this._input)}this._input=null;this._createInput()}},_createForm:function(t){var s=this._settings;var u=c('<form method="post" enctype="multipart/form-data"></form>');u.style.display="none";u.action=s.action;u.target=t.name;j.body.appendChild(u);for(var v in s.data){var d=j.createElement("input");d.type="hidden";d.name=v;d.value=s.data[v];u.appendChild(d)}return u}}})();